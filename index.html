<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Basit Anlık Voice Chat</title>
<style>
body { font-family: sans-serif; text-align: center; margin-top: 50px; }
input, button { padding: 10px; margin: 5px; font-size: 16px; }
audio { margin-top: 20px; width: 300px; }
</style>
</head>
<body>

<h1>Basit Anlık Voice Chat</h1>
<p>Kendi ID'nizi oluşturun veya boş bırakın</p>
<input id="peerId" placeholder="Kendi ID (Opsiyonel)">
<p>Bağlanmak istediğiniz kişinin ID'si:</p>
<input id="remoteId" placeholder="Karşı ID">
<br>
<button id="startBtn">Bağlan / Ses Başlat</button>

<audio id="remoteAudio" autoplay></audio>

<script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
<script>
const startBtn = document.getElementById('startBtn');
const remoteAudio = document.getElementById('remoteAudio');
const peerIdInput = document.getElementById('peerId');
const remoteIdInput = document.getElementById('remoteId');

let localStream;
let peer;
let call;

async function initPeer() {
  localStream = await navigator.mediaDevices.getUserMedia({ audio: true });

  peer = new Peer(peerIdInput.value || undefined);

  peer.on('open', id => {
    alert("Kendi ID'niz: " + id + "\nBunu karşı tarafa verin!");
  });

  peer.on('call', incomingCall => {
    incomingCall.answer(localStream);
    incomingCall.on('stream', remoteStream => {
      remoteAudio.srcObject = remoteStream;
    });
  });
}

startBtn.onclick = async () => {
  if (!peer) await initPeer();

  const remoteId = remoteIdInput.value.trim();
  if (!remoteId) return alert("Karşı ID'yi girin!");

  call = peer.call(remoteId, localStream);
  call.on('stream', remoteStream => {
    remoteAudio.srcObject = remoteStream;
  });
};
</script>

</body>
</html>
